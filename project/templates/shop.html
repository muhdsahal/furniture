{% extends 'base.html' %}
{% block title %}aranoz{% endblock %}
{% load static %}
{% block body %}

<style>
  /* Custom CSS to add distance between the navbar and cards */
  .custom-card-container {
    margin-top: 50px;
  }
</style>
<!--================Category Product Area =================-->
<section class="cat_product_area section_padding">
  <div class="container">
      <div class="row">
          <div class="col-lg-3">
              <div class="left_sidebar_area">
                  <aside class="left_widgets p_filter_widgets">
                      <div class="l_w_title">
                          <h3>Browse Categories</h3>
                      </div>
                      <div class="widgets_inner">
                          <ul class="list">
                            {% for i in cate %}
                            <li>
                                <a href="{% url 'cat_detail' i.id %}">{{i.categories}}</a>
                                <!--<span>(250)</span>-->
                            </li>
                            {% endfor %} 
                          </ul>
                      </div>
                  </aside>
                  
                   {% comment %} <aside class="left_widgets p_filter_widgets">
                      <div class="l_w_title">
                          <h3>Product filters</h3>
                      </div>
                      <div class="widgets_inner">
                          <ul class="list">
                              <li>
                                  <a href="#"  id="sort-atoz">A to Z </a>
                              </li>
                              <li>
                                  <a href="#">Asus</a>
                              </li>
                              <li class="active">
                                  <a href="#">Gionee</a>
                              </li>
                              <li>
                                  <a href="#">Micromax</a>
                              </li>
                              <li>
                                  <a href="#">Samsung</a>
                              </li>
                          </ul>
                          <ul class="list">
                              <li>
                                  <a href="#">Apple</a>
                              </li>
                              <li>
                                  <a href="#">Asus</a>
                              </li>
                              <li class="active">
                                  <a href="#">Gionee</a>
                              </li>
                              <li>
                                  <a href="#">Micromax</a>
                              </li>
                              <li>
                                  <a href="#">Samsung</a>
                              </li>
                          </ul>
                      </div>
                  </aside>  {% endcomment %}
{% comment %} 
                  <aside class="left_widgets p_filter_widgets">
                      <div class="l_w_title">
                          <h3>Color Filter</h3>
                      </div>
                      <div class="widgets_inner">
                          <ul class="list">
                              <li>
                                  <a href="#">Black</a>
                              </li>
                              <li>
                                  <a href="#">Black Leather</a>
                              </li>
                              <li class="active">
                                  <a href="#">Black with red</a>
                              </li>
                              <li>
                                  <a href="#">Gold</a>
                              </li>
                              <li>
                                  <a href="#">Spacegrey</a>
                              </li>
                          </ul>
                      </div>
                  </aside> {% endcomment %}

                  {% comment %} <aside class="left_widgets p_filter_widgets price_rangs_aside">
                      <div class="l_w_title">
                          <h3>Price Filter</h3>
                      </div>
                      <div class="widgets_inner">
                          <div class="range_item">
                              <!-- <div id="slider-range"></div> -->
                              <input type="text" class="js-range-slider" value="" />
                              <div class="d-flex">
                                  <div class="price_text">
                                      <p>Price :</p>
                                  </div>
                                  <div class="price_value d-flex justify-content-center">
                                      <input type="text" class="js-input-from" id="amount" readonly />
                                      <span>to</span>
                                      <input type="text" class="js-input-to" id="amount" readonly />
                                  </div>
                              </div>
                          </div>
                      </div>
                  </aside>  {% endcomment %}
              </div>
          </div>
          <div class="col-lg-9">
              <div class="row">
                  <div class="col-lg-12">
                      <div class="product_top_bar d-flex justify-content-between align-items-center">
                          <div class="single_product_menu">
                              <p><span>10000 </span> Prodict Found</p>
                          </div>
                         {% comment %} <div class="single_product_menu d-flex">
                              <h5>short by : </h5>
                              <select>
                                  <option data-display="Select">name</option>
                                  <option value="1">price</option>
                                  <option value="2">product</option>
                              </select>
                          </div> 
                          <div class="single_product_menu d-flex">
                              <h5>show :</h5>
                              <div class="top_pageniation">
                                  <ul>
                                      <li>1</li>
                                      <li>2</li>
                                      <li>3</li>
                                  </ul>
                              </div>
                          </div>  {% endcomment %}
                          <div class="single_product_menu d-flex">
                            <div class="input-group">
                                <form action="{% url 'search_product' %}">
                                    <input type="text" class="form-control" name="keyword" placeholder="Search"
                                        aria-describedby="inputGroupPrepend">
                                    <div class="input-group-append"> <!-- Changed from input-group-prepend -->
                                        <button type='submit' class="btn btn-outline-secondary" id="inputGroupPrepend">
                                            <i class="ti-search"></i> <!-- Use an appropriate icon class -->
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                          

                      </div>
                  </div>
              </div>
              <section style="background-color: white;">
                <div class="container py-5 custom-card-container">
                  <div class="row">
                    {% if variant_images %}
                    {% for c in variant_images %}
                    {% if forloop.counter0|divisibleby:3 %}
                    </div>
                    <div class="row">
                    {% endif %}
                    <div class="col-md-4 mb-4">
                      <div class="card">
                        <div class="position-relative">
                          <a href="{% url 'product_details' c.variant.product.id c.variant.id %}">
                            <img src="{{ c.image.url }}" class="card-img-top" alt="img" />
                          </a>
                          
                        </div>
                        <div class="card-body">
                          <h5 class="card-title">{{ c.variant.product.product_name }}</h5>
                          <h6 class="card-price"> â‚¹{{ c.variant.product.product_price }}</h6>
                          <div class="d-flex justify-content-between mt-3">
                            
                            
                            <button  class="btn_3 addToCartBtn" data-product_id ="{{ c.variant.id }}">{% if product.product_quantity > 0  %}Add to cart {% else %}Out of stock{% endif %}</button> 
                            <div class="icon-overlay">
                                <a href="" data-product_id ="{{ c.variant.id }}" class="wishlist-icon">
                                   <img src="{% static 'img/heart.png'%}" alt="img"> </i>
                                </a>
                              </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    {% endfor %}
                    {% endif %}
                  </div>
                </div>
              </section>
             <!-- ... -->
            <ul>
                {% for product in page_obj %}
                <li>{{ product.name }} - Price: {{ product.price }} - Size: {{ product.size }}</li>
                {% endfor %}
            </ul>

            <div class="pagination">
                <span class="step-links">
                    {% if page_obj.has_previous %}
                        <a href="?page=1">&laquo; first</a>
                        <a href="?page={{ page_obj.previous_page_number }}">previous</a>
                    {% endif %}

                    <span class="current">
                        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                    </span>

                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}">next</a>
                        <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
                    {% endif %}
                </span>
            </div>
            <!-- ... -->
                
              
                  <div class="col-lg-12">
                      <div class="pageination">
                          <nav aria-label="Page navigation example">
                              <ul class="pagination justify-content-center">
                                  <li class="page-item">
                                      <a class="page-link" href="#" aria-label="Previous">
                                          <i class="ti-angle-double-left"></i>
                                      </a>
                                  </li>
                                  <li class="page-item"><a class="page-link" href="#">1</a></li>
                                  <li class="page-item"><a class="page-link" href="#">2</a></li>
                                  <li class="page-item">
                                      <a class="page-link" href="#" aria-label="Next">
                                          <i class="ti-angle-double-right"></i>
                                      </a>
                                  </li>
                              </ul>
                          </nav>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>
</section>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.20/dist/sweetalert2.all.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>
    $('.wishlist-icon').click(function (e) {
        e.preventDefault();

        var product_id = $(this).data('product_id');

        $.ajax({
            method: "POST",
            url: "{% url 'add_wishlist' %}",
            data: {
                'prod_id': product_id,
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function (response) {
                console.log(response);

                if (response.status === 'product already in wishlist') {
                    Swal.fire("Error!", response.status, "error");
                } else if (response.status === 'product added to wishlist') {
                    Swal.fire("", response.status, "success");
                } else if (response.status === 'login and continue') {
                    Swal.fire("", response.status, "warning");
                } else if (response.status === 'something went wrong ,reload page') {
                    Swal.fire("", response.status, "warning");
                } else {
                    Swal.fire("Error!", response.status, "error");
                }
            },
            error: function (xhr, status, error) {
                console.log(xhr.responseText); // Log the detailed error response
                Swal.fire("Error!", "An error occurred. Please try again later.", "error");
            }
        });
    });
</script>




<script>
    $('.addToCartBtn').click(function (e) {
        e.preventDefault();

        var product_id = $(this).data('product_id');
        var product_qty = 1;
        console.log(product_id, product_qty)
       
        //var selected_size = $(this).closest('.product_data').find('#size').val(); // Get the selected size value
        console.log(product_id,'daxoooooo')
        console.log(product_qty,'daxoooooo')
      
        $.ajax({
            method: "POST",
            url: "{% url 'add_cart' %}",
            data: {
                'product_qty': product_qty,
                'prod_id': product_id,
                //'size': selected_size, // Include the selected size in the data
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            
            success: function (response) {

              console.log(response);



              if (response.status === 'No such prodcut found' || response.status === 'Only few quantity available' || response.status === 'product already in cart' ) {
                  Swal.fire("Error!", response.status, "error");
                  $('.cartdata').load(location.href + " .cartdata");
              } else if (response.status === 'Product added successfully') { 
                  Swal.fire("", response.status, "success");
                  $('.cartdata').load(location.href + " .cartdata");
              } else if (response.status === 'you are not login please Login to continue') {
                  Swal.fire("", response.status, "warning");
                  $('.cartdata').load(location.href + " .cartdata");
              } 
              else if (response.status === 'Sorry! this variant not available') {
                  Swal.fire("", response.status, "warning");
                  $('.cartdata').load(location.href + " .cartdata");
              } 
              else {
                  Swal.fire("Error!", response.status, "error");
                  $('.cartdata').load(location.href + " .cartdata");
              }
          }
        });
    });
</script>
{% endblock %}